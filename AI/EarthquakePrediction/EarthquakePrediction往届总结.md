# Earthquake Prediction往届优胜队伍经验总结

## 4freedom

### 数据处理

* 只选用**每天最大规模**的震级和震中作为训练数据
* 电磁/低声取**每天每站点**平均值
* 缺失数据使用线性插值补充

### 算法

#### 震级预测

* 通过类比问题，筛选并参考了《Time-series Extreme Event Forecasting with Neural Networks at Uber》中提出的算法。
* 特征提取
  * 手动提取了18中特征
  * 使用LSTM自编码器自动提取特征
* 震级预测，使用简单LSTM神经网络进行震级预测

#### 震中预测

* 通过类比问题，筛选并参考了《Correlating Events with Time Series for Incident Diagnosis》中的报警关联分析方法。

## CIDP

### 数据处理

#### 标签样本

* 使用k-means++将地震分为9个区域
* 将所有大于3.5级的地震安装0.5级为间隔划分9类，小于3.5为0
* 样本取每七天的最大震级

#### 数据样本

* 处理流程
  1. 对所有数据以十分钟为间隔进行均值降采样，之后对缺值进行线性插值补充
  2. 将所有站点的magn数据追加到同一个csv文件。并以天为单位划分为块。sound数据同理。
  3. 使用官方提供的特征提取方式提取两个csv文件中的每日特征数据，选中47特征值。并输出为二维数组（days， 47）。
  4. 最终将样本转化为以周为单位的独立样本（7，47）

### 算法

* **Nested-LSTM模型**。较传统LSTM模型优化了时间复杂度。
* 使用**第一周**的数据样本对应**第二周**的标签样本。（本周地声/电磁数据预测下周地震）
* 使用**准确率和损失函数图**来观测模型
* 为了防止模型预测的不确定性，采用**投票法**产生最终结果
  * 投票法：保存500个model，每100个为一组。通过投票选出结果。

## Helloworld队（亚军）

https://blog.csdn.net/xiaobei125521/article/details/111573615

### 数据处理

* 按照地区划分：鲜水河地震带、安宁河-则木河地震带、金沙江地震带、松潘-较场地震带、龙门山地震带、理塘地震带、木里-盐源地震区、名山-马边-昭通地震带、小江地震带、中甸—南涧地震带、大关—马边地震带、澜沧—耿马地震带、泸水—腾冲地震带、普洱—宁洱地震带、通海—石屏地震带。
* 按照时间划分：地震发生前一周（？）
* 按震级划分：多为3-6级地震，分为四级：0-3.4/3.5-4.4/4.5-5.4/5.5-8.0
* 数据补全：线性插值：以1 天数据的10%作为阈值，如果连续缺失10%以内的数据，将采用线性插值法来对缺失的数据进行补全，如果连续缺失10%以上的数据，插值补全会引入较大误差，则删掉当天数据。（？）

### 算法

* 特征提取
  * 衍生特征：计算电磁和地声数据的**临近差值**、每天**SRSS**波存在与否、每天SRSS波幅值等。
    * SRSS波：站点提供的91中feature中的一种
      * 每日数据按照小时统计其最大值，若前一个小时的最大值（VH）明显高于后一个小时的最大值（VL）2 倍或以上，则认为当天存在SRSS波。
      * 提取方法
        1. 以天为滑窗范围，数据标准化
        2. 筛选符合SRSS特点的数据，定义为模板
        3. 检测SRSS
      * 预处理：加窗Max-Min标准化：以天为窗口单位，利用每天数据中的极大值、极小值对该窗口内的时间序列进行标准化处理。（？）
  * 统计特征：电磁与地声特征值每天的最大/最小/均值/方差/偏度/峰度/**均方根**/**波形因子/峰值因子/脉冲因子/裕度因子**/最大最小值差/**滑动四分位数/变异系数**
  * 额外衍生特征：通过用**随机森林的特征重要性筛选方法**选出特征重要性排前50的特征，两两交叉相乘得出新特征。
  * 将SRSS波及其编译作为重要的临震信号
    * 定义srss波：分析台站数据->分析区域内数据->定义SRSS波模板（？）
    * 检测SRSS波：互相关测度：按天为单位，计算每一个序列与SRSS波模板之间滑动内积，以其最大内积为两条序列的相关性度量。（？）
* 数据分类
  * 使用**stacking方法**进行建模，第一层模型为**lightgbm**、随机森林和**catboost**，第二层为**逻辑回归**。
* 地震预测方法：**古登堡-理查德定律**

### 未完成部分

* 基于时序数据的特点，采用信号处理方式和时间序列分割方法
  * 信号处理的方法：希尔伯特变换，小波变换等方式处理时序数据，获取时序数据在频域的特点；
  * 采用时序序列分割的方式：将数据分段，精细刻画数据，使数据成为更易操作的向量，从而挖掘其中的波形的分布规律。
* 针对不同数据缺失情况，采用不同数据补全方式

## szpianpian

### 数据处理

* 删除缺失严重的station数据

### 算法

* 特征提取
  * 选取标准： 可解释性/可泛化/训练时长
  * 最终选取 震级/震源深度/发生时间 (? 这里不应该是电磁/地声的特征吗？)
  * 样本集 
    * 选取地声数据集
    * 侧重夜间数据来降噪
    * 结合中国地震网数据 http://www.ceic.ac.cn/speedsearch
* 预测模型：
  * 混合模型：**回归模型**，长短记忆神经网络（Long Short -Term Memory，**LSTM**），**决策树**
    * L S T M 是一种循环神经网络，具有极强的非线性拟合能力，在训练间缓解反向传播过程中的梯度消减。
    * 回归和决策树模型有很好的解释性。

## 黄粱一梦

### 数据处理

* 数据缺失严重，完整性不足
  * 同一时间点均值补全
    * 用不同天的同一时间点的均值
* 无地震样本会干扰预测性能
  * 用未来一次地震的信息进行补全
    * 对于下一周无地震的样本，我们使用未来最先发生地震进行填充。
    * 解决大量样本无经纬度和震级的尴尬处境，并提高了准确率
* 数据情况复杂
  * 采用统一采样率（10min）
    * 每天144个样本
  * 对震级分组编码
    * 3.5级开始，每0.3为一组。11组
  * 对经纬坐标分组编码
    * 使用k-means将样本分为20种
  * **双输入三输出神经网络**（？）

### 算法

* 使用神经网络，但是因为不懂，所以不知道是哪种类型
  * 有图但是看不懂，双输入为电磁和地声，输出为是否地震/经纬度/震级

## 人工智能靠人工

### 数据处理

* 数据滤除
  * 删除规定区域外的监测点
  * 删除咩有数据的监测点
  * 对监测点进行排序
* 数据归一化
  * 对数据进行每十分钟的均值处理，如果有少量缺失，用后面的值补充

### 算法

* 特征提取
  * 训练集。以天为单位对灭个监测点滑动窗口提取地声/地磁。shape:（样本数，7\*24\*6, 2）
    * 标签。shape：（样本数，2），震级和震中到站点距离
  * 测试集。以周为单位对每个监测点提取地磁/地声。shape:(样本数，7\*24\*6, 2)

* 模型训练（ppt没有体现）

## 三王一张

### 特征提取

* 均值/差值/每天最大/每天最小/每天均值/每天最大最小差值/一周内每天最大均值/一周内每天最小均值/一周内每天均值最大/一周内每天均值最小/**偏度**/方差/**偏值的偏度/偏值的方差**
* 地声/地测提取特征 见pdf

### 算法

* light GBM：预测是否有地震，以及震级的范围大小
* random forest1 预测震级大小，地震位置
* random forest2 判断是否为大震或无震

* pdf 有算法相关

## 神奇宝可梦

### 数据处理

* 电磁数据，若有缺失补0
* 地声数据，若有被修改记录，改为0

### 特征构建

* 电磁/地声数据
  * 每小时最大/每小时最小/每小时平均
  * 选取六个特征
  * 168个站点
  * 七天(168小时)
  * shape(168, 168, 6)

### 样本构建

* 结构：（是否地震，下周内最大震级的信息， 下周内次大震级的信息）
  * 震级信息包括 :  经纬度+震级

* 归一化：将地震要素规范到0-1之间
* 处理样本不平衡问题，取等量正负样本构成数据集
  * 正样本：有地震发生的样本
  * 负样本：没有地震发生的样本
* 训练集合与验证集中正负样本比例：1：1
* 训练集与验证集样本总数比例9：1

### 算法

* 时空图卷积网络(Spatio-temporal graph convolutional neural network , STGCN)
  * 切比雪夫卷积层（？）

* 校验
  * 损失函数
  * 模型评价指标

## 时光倒流

### 数据处理

* 使用低精度类型替换高精度类型来降低空间占用
* 使用当前数据减均值的方法降低数据量
* 处理异常数据（缺失和异常点）
* 数据整合
  * 根据stationId，电磁地声数据和台站数据用merge方法合并

### 特征提取

* 每七天取一次数据
* 前一个数据和当前数据的差值/均值/最大/最小/峰值/**偏度**等
* 一种基于特征排序的在线分配算法：特征过滤（correlation analysis）
  * 46个特征
  * 使用皮尔逊相关系数过滤
  * 保留36个
* 进一步特征过滤 LightGBM
  * 最终八六32个

### 构建样本集

1. 默认为负样本
2. 按照时间顺序从地震事件中选取事件
3. 检查选取事件500公里内是否有站点，如果没有回到step. 2。如果有，将范围内站点列表由近到远排序并取出
4. 将该站点前N天的标签更新为正样本

### 算法

* KNN算法
* LightGBM算法
* 决策树
* pdf有代码
* 权重自适应（？）

## 总结

* ### 数据可能会出现大量缺失的问题
  
  1. 线性均值插值
  2. 补0
  3. 删除数据
  4. 量少的话直接用后面的值补充
  
* ### 电磁/地声数据量庞大（分钟级）
  
  1. 每十分钟均值
  2. 每小时取值
  3. 每七天取值
  4. 使用低精度类型替换高精度类型来降低空间占用
5. 使用当前数据减均值的方法降低数据量

* ### 特征提取的几种方案
  
  * 手动提取特征
  * 电磁与地声特征值每天的最大/最小/均值/方差/偏度/峰度/**均方根**/**波形因子/峰值因子/脉冲因子/裕度因子**/最大最小值差/**滑动四分位数/变异系数**/每天最大最小差值/一周内每天最大均值/一周内每天最小均值/一周内每天均值最大/一周内每天均值最小/**偏值的偏度/偏值的方差**
  * LSTM自编码器自动提取特征
  * SRSS波 ？
  * 通过用**随机森林的特征重要性筛选方法**选出特征重要性排前50的特征，两两交叉相乘得出新特征。
  * 时间筛选？ （侧重夜间数据来降噪）
  * lightGBM 过滤
* 皮尔逊相关系数过滤
  
* ### 算法的几种方案（按顺序排列）
  
  * LSTM：3次 | lightgbm： 3次 | 随机森林：2次 | 决策树：2次
  * 震级预测，使用简单LSTM神经网络进行震级预测 +震中预测，《Correlating Events with Time Series for Incident Diagnosis》中的报警关联分析方法。
  * Nested-LSTM模型 + 投票法 （本周地声/电磁数据预测下周地震）
  * 使用**stacking方法**进行建模，第一层模型为**lightgbm**、随机森林和**catboost**，第二层为**逻辑回归**。
    * 地震预测方法：**古登堡-理查德定律**
  * 混合模型：**回归模型**，长短记忆神经网络（Long Short -Term Memory，**LSTM**），**决策树**
  * **双输入三输出神经网络**（？）
  * light GBM + random forest1 + random forest2
    * light GBM  预测是否有地震，以及震级的范围大小
    * random forest1 预测震级大小，地震位置
    * random forest2 判断是否为大震或无震
  * 时空图卷积网络
  * knn + lightgbm + 决策树
  
* ### 校验结果的几种方案
  
  * 用**准确率和损失函数图**来观测模型 （CIDP）
  * 损失函数 + 模型评价指标 (神奇宝可梦)
  
* ### 其他
  
  * 样本处理归一化 
  * 负样本处理（正负样本平衡 / 全部正样本化）

